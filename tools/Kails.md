# 【Step2】 サーバーサイドの処理を作る
【Step1】でデータベースが用意されているので、モデルクラスを使ってサーバーサイドの処理を作ります。通常のNodeJSでのサーバー開発と同じで、コンソールで`/kails`フォルダに移動して作業します。

NodeJSの[インストール][u1]後、
```
npm i
```
で必要なライブラリをダウンロードしておきます。（蛇足ですがNodeJSのインストールは各OSのパッケージマネージャを使うのがいいと思います）。

サーバーサイド開発の前に、データベースを作った直後、あるいはデータベースのテーブル構成を修正した後は、データベースのテーブルからモデルクラスを自動生成することが必要です。古いモデルクラスを削除し、sequelize-autoを使ってモデルクラスを自動生成するという手順が必要ですが、
```
npm run db:models
```
というコマンドに集約しました。これを実行するだけで、`/kails/app/models/auto_gen/`フォルダにモデルクラスが作られます。

後は、サーバーを起動して処理を作っていくだけです。
```
npm start
```
を実行すると http://localhost:3000 でサーバーが起動し、コンソールには以下のように出力されます。
```
> kails@0.1.0 start /xxx/workspace/kails_plus/kails
> nodemon app/index.js

[省略...]

────────────────────────────────────────────────
user 1 ────*n user_book
user_book  ──── 1 user
────────────────────────────────────────────────
user n*────*m user_group
────────────────────────────────────────────────
user 1 ──── 1 user_phone
user_phone  ──── 1 user
────────────────────────────────────────────────
```
データベースから生成されたモデルクラスが読み取られ、リレーションも正確に読み取られて設定されている様子が分かるでしょう。

サーバーが起動したら、あとは`/kails/app/routes/`にAPIのエンドポイントを、`/kails/app/controllers/`に処理を書きます。

`/kails/app/controllers/userList`を見るとsequelizeのmodelsを使ってデータベースへのCURDや、リレーションを使ったReadもできていることが分かるでしょう。  

実際に動かしてみたい場合は、【Step3】に進んでください。  
動いている、という実感が湧きにくいサンプルですが、データベースを開いたり実際のソースコードを読んで見れば十分理解できるでしょう。
当リポジトリではJsonを受け取り、Jsonを返す、アプリケーション用のAPIを作ることを想定しています（ejsを使ってブラウザ用のHTML画面を作ることもできます）。

[＞ APIサーバーの準備ができたらクライアントとしてReact-appを動かしてみましょう。](./React-app.md)  
[＞ Topに戻る](../README.md)

[u1]:https://nodejs.org/ja/download/package-manager/